name: Validate Workflows

on:
  push:
    paths:
      - '.github/workflows/**'
  pull_request:
    paths:
      - '.github/workflows/**'
  workflow_dispatch:

jobs:
  validate:
    name: Validate Workflow Syntax
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate workflow files
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const path = require('path');
            const yaml = require('js-yaml');
            
            const workflowsDir = '.github/workflows';
            const workflowFiles = fs.readdirSync(workflowsDir)
              .filter(file => file.endsWith('.yml') || file.endsWith('.yaml'));
            
            let hasErrors = false;
            
            for (const file of workflowFiles) {
              const filePath = path.join(workflowsDir, file);
              try {
                const content = fs.readFileSync(filePath, 'utf8');
                yaml.load(content);
                console.log(`✓ ${file} - Valid YAML`);
              } catch (error) {
                console.error(`✗ ${file} - Invalid YAML: ${error.message}`);
                hasErrors = true;
              }
            }
            
            if (hasErrors) {
              core.setFailed('One or more workflow files have syntax errors');
            }

      - name: Check for required secrets
        uses: actions/github-script@v7
        with:
          script: |
            const requiredSecrets = [
              'NETSPARKLE_PRIVATE_KEY',
              'NETSPARKLE_PUBLIC_KEY'
            ];
            
            console.log('Required secrets for workflows:');
            requiredSecrets.forEach(secret => {
              console.log(`  - ${secret}`);
            });
            
            console.log('\nNote: These secrets must be configured in repository settings.');

